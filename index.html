<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æˆ‘çš„æ–‡ä»¶ç«™</title>
  <style>
      body {
          font-family: Arial, sans-serif;
          margin: 0;
          padding: 0;
          display: flex;
          height: 100vh;
      }
      .sidebar {
          width: 250px;
          background-color: #f4f4f4;
          padding: 20px;
          box-shadow: 2px 0 5px rgba(0,0,0,0.1);
      }
      .navbar {
          display: flex;
          background-color: #333;
          color: white;
          padding: 10px 20px;
      }
      .navbar a {
          color: white;
          text-decoration: none;
          margin-right: 15px;
          padding: 5px 10px;
      }
      .navbar a:hover {
          background-color: #555;
      }
      .content {
          flex-grow: 1;
          padding: 20px;
          overflow-y: auto;
      }
      #docSelect {
          width: 100%;
          padding: 10px;
          margin-bottom: 20px;
      }
      .main-content {
          margin-top: 50px;
      }
  </style>
</head>
<body>
  <div class="sidebar">
      <h3>æ–‡ä»¶ç›®éŒ„</h3>
      <select id="docSelect" onchange="loadDocument()">
          <option value="">é¸æ“‡æ–‡ä»¶</option>
          <!-- é€™è£¡æœƒå‹•æ…‹å¡«å…¥ doc ç›®éŒ„çš„ Markdown æ–‡ä»¶ -->
      </select>
      <div id="documentContent"></div>
  </div>

  <div class="content">
      <nav class="navbar">
          <a href="#" onclick="showHome()">é¦–é </a>
          <a href="#" onclick="showDownloads()">ä¸‹è¼‰</a>
      </nav>

      <div class="main-content" id="mainContent">
          <h1>æ­¡è¿ä¾†åˆ°æˆ‘çš„æ–‡ä»¶ç«™</h1>
          <p>é€™æ˜¯ä¸€å€‹éœæ…‹ç¶²ç«™ï¼Œæä¾›æ–‡ä»¶ç€è¦½å’Œä¸‹è¼‰æœå‹™ã€‚</p>
      </div>
  </div>

  <script>
      // å‹•æ…‹è¼‰å…¥ doc ç›®éŒ„çš„æ–‡ä»¶åˆ—è¡¨
      async function loadDocumentList() {
          try {
              const response = await fetch('/doc');
              const text = await response.text();
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(text, 'text/html');
              const links = htmlDoc.querySelectorAll('a');
              const select = document.getElementById('docSelect');

              links.forEach(link => {
                  if (link.href.endsWith('.md')) {
                      const option = document.createElement('option');
                      option.value = link.href;
                      option.textContent = link.textContent;
                      select.appendChild(option);
                  }
              });
          } catch (error) {
              console.error('ç„¡æ³•è¼‰å…¥æ–‡ä»¶åˆ—è¡¨', error);
          }
      }

      // è¼‰å…¥ Markdown æ–‡ä»¶
      async function loadDocument() {
          const select = document.getElementById('docSelect');
          const url = select.value;
          const documentContent = document.getElementById('documentContent');

          if (!url) return;

          try {
              const response = await fetch(url);
              const markdownText = await response.text();
              
              // ä½¿ç”¨ marked.js è½‰æ› Markdownï¼ˆéœ€è¦åœ¨ HTML ä¸­å¼•å…¥ marked.jsï¼‰
              documentContent.innerHTML = marked.parse(markdownText);
          } catch (error) {
              console.error('ç„¡æ³•è¼‰å…¥æ–‡ä»¶', error);
              documentContent.textContent = 'æ–‡ä»¶è¼‰å…¥å¤±æ•—';
          }
      }

      // é¡¯ç¤ºä¸‹è¼‰é é¢
      function showDownloads() {
          const mainContent = document.getElementById('mainContent');
          mainContent.innerHTML = `
              <h2>ä¸‹è¼‰ä¸­å¿ƒ</h2>
              <div id="downloadLinks"></div>
          `;

          // å‹•æ…‹è¼‰å…¥ download ç›®éŒ„çš„æª”æ¡ˆ
          fetch('/download')
              .then(response => response.text())
              .then(text => {
                  const parser = new DOMParser();
                  const htmlDoc = parser.parseFromString(text, 'text/html');
                  const links = htmlDoc.querySelectorAll('a');
                  const downloadLinksDiv = document.getElementById('downloadLinks');

                  links.forEach(link => {
                      const fileLink = document.createElement('div');
                      fileLink.innerHTML = `
                          <a href="${link.href}" download>
                              ğŸ“ ${link.textContent}
                          </a>
                      `;
                      downloadLinksDiv.appendChild(fileLink);
                  });
              });
      }

      // é¡¯ç¤ºé¦–é 
      function showHome() {
          const mainContent = document.getElementById('mainContent');
          mainContent.innerHTML = `
              <h1>æ­¡è¿ä¾†åˆ°æˆ‘çš„æ–‡ä»¶ç«™</h1>
              <p>é€™æ˜¯ä¸€å€‹éœæ…‹ç¶²ç«™ï¼Œæä¾›æ–‡ä»¶ç€è¦½å’Œä¸‹è¼‰æœå‹™ã€‚</p>
          `;
      }

      // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
      document.addEventListener('DOMContentLoaded', () => {
          loadDocumentList();
      });
  </script>

  <!-- å¼•å…¥ marked.js ç”¨æ–¼ Markdown è½‰æ› -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</body>
</html>